import{r,A as y,u as S,j as s,B as i,C as k,R as z,a as f,c as o,M as c,b as D}from"./index-CjvveDhR.js";import{A as M}from"./LoadingAnimations-_zIpEffa.js";import{A as E}from"./Alert-CNoVHXkI.js";const Q=()=>{const{user:t,logout:d}=r.useContext(y),n=S(),[m,p]=r.useState([]),[v,b]=r.useState(!0),[h,j]=r.useState(null),[C,u]=r.useState(!1),[a,N]=r.useState(null);r.useEffect(()=>{if(!t||t.role!=="admin"){n("/administracion");return}(async()=>{try{const l=localStorage.getItem("token"),x=await fetch(D.quotes,{headers:{Authorization:`Bearer ${l}`}});if(!x.ok)if(x.status===403)j("No tienes permisos para ver las cotizaciones."),await d(),n("/administracion");else throw new Error("Error al cargar las cotizaciones.");const A=await x.json();p(A)}catch(l){j(l.message)}finally{b(!1)}})()},[t,n,d]);const w=e=>{N(e),u(!0)},g=()=>{u(!1),N(null)};return v?s.jsx("div",{className:"loading-overlay",children:s.jsxs("div",{className:"loading-content",children:[s.jsx("div",{className:"loading-spinner"}),s.jsx("p",{children:"Cargando cotizaciones..."})]})}):h?s.jsx("div",{className:"error-state",children:s.jsxs("div",{className:"error-message",children:[s.jsx("h4",{children:"Error al cargar las cotizaciones"}),s.jsx("p",{children:h}),s.jsx(i,{variant:"outline-danger",onClick:()=>window.location.reload(),children:"Reintentar"})]})}):s.jsxs(s.Fragment,{children:[s.jsxs("section",{className:"admin-dashboard-section",children:[s.jsxs(k,{fluid:!0,className:"px-2 px-md-3",children:[s.jsx("h2",{className:"text-center mb-4 text-uppercase fw-semibold text-white",children:"Panel de AdministraciÃ³n"}),s.jsxs("div",{className:"admin-stats-summary",children:[s.jsxs("h4",{children:["Total Cotizaciones: ",m.length]}),s.jsxs("div",{className:"mt-3",children:[s.jsxs(i,{variant:"success",onClick:()=>n("/administracion/facturacion"),className:"me-2",children:[s.jsx("span",{className:"me-2",children:"ðŸ“„"}),"Generar Nueva Factura"]}),s.jsxs(i,{variant:"info",onClick:()=>n("/administracion/facturas"),className:"me-2",children:[s.jsx("span",{className:"me-2",children:"ðŸ“‹"}),"Ver Facturas"]})]})]}),s.jsx(z,{xs:1,sm:2,lg:3,xl:4,className:"g-3 g-md-4",children:m.length>0?m.map((e,l)=>s.jsx(f,{className:"slide-up",style:{animationDelay:`${l*.1}s`},children:s.jsx(o,{className:"quote-admin-card h-100 interactive-element",children:s.jsxs(o.Body,{className:"d-flex flex-column",children:[s.jsx(o.Title,{className:"fw-bold text-truncate",title:e.name,children:e.name}),s.jsxs(o.Text,{className:"flex-grow-1",children:[s.jsx("strong",{children:"RUT:"})," ",e.rut,s.jsx("br",{}),s.jsx("strong",{children:"Altura:"})," ",e.fenceHeight,s.jsx("br",{}),s.jsx("strong",{children:"Metros:"})," ",e.linearMeters,"m"]}),s.jsx(i,{variant:"primary",onClick:()=>w(e),className:"mt-auto touch-feedback mb-2",size:"sm",children:"Ver Detalles"}),s.jsx(i,{variant:"success",onClick:()=>n("/administracion/facturacion",{state:{selectedQuote:e}}),className:"touch-feedback",size:"sm",children:"ðŸ“„ Crear Factura"})]})})},e.id)):s.jsx(f,{xs:12,className:"fade-in",children:s.jsx(E,{variant:"info",className:"text-center",children:"No hay cotizaciones para mostrar."})})})]}),s.jsxs(c,{show:C,onHide:g,centered:!0,size:"lg",className:"quote-detail-modal",children:[s.jsx(c.Header,{closeButton:!0,children:s.jsx(c.Title,{children:"Detalles de CotizaciÃ³n"})}),s.jsx(c.Body,{children:a&&s.jsx("div",{className:"quote-details",children:s.jsxs("div",{className:"row g-3",children:[s.jsx("div",{className:"col-sm-6",children:s.jsxs("p",{children:[s.jsx("strong",{children:"Nombre:"}),s.jsx("br",{}),a.name]})}),s.jsx("div",{className:"col-sm-6",children:s.jsxs("p",{children:[s.jsx("strong",{children:"RUT:"}),s.jsx("br",{}),a.rut]})}),s.jsx("div",{className:"col-sm-6",children:s.jsxs("p",{children:[s.jsx("strong",{children:"TelÃ©fono:"}),s.jsx("br",{}),a.phone]})}),s.jsx("div",{className:"col-sm-6",children:s.jsxs("p",{children:[s.jsx("strong",{children:"Email:"}),s.jsx("br",{}),a.email]})}),s.jsx("div",{className:"col-12",children:s.jsxs("p",{children:[s.jsx("strong",{children:"DirecciÃ³n/Comuna:"}),s.jsx("br",{}),a.address]})}),s.jsx("div",{className:"col-sm-6",children:s.jsxs("p",{children:[s.jsx("strong",{children:"Altura del Cerco:"}),s.jsx("br",{}),a.fenceHeight]})}),s.jsx("div",{className:"col-sm-6",children:s.jsxs("p",{children:[s.jsx("strong",{children:"Metros Lineales:"}),s.jsx("br",{}),a.linearMeters]})}),s.jsx("div",{className:"col-12",children:s.jsxs("p",{children:[s.jsx("strong",{children:"Mensaje Adicional:"}),s.jsx("br",{}),a.message||"N/A"]})}),s.jsx("div",{className:"col-12",children:s.jsxs("p",{children:[s.jsx("strong",{children:"Fecha de Solicitud:"}),s.jsx("br",{}),new Date(a.timestamp).toLocaleString()]})})]})})}),s.jsx(c.Footer,{children:s.jsx(i,{variant:"secondary",onClick:g,children:"Cerrar"})})]})]}),s.jsx(M,{user:t,onLogout:d})]})};export{Q as default};
