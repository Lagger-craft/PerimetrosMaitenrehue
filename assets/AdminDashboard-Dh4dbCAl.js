import{r,A as y,u as S,j as e,B as h,C as D,R as z,a as p,c as t,M as l,b as M}from"./index-CY5RqpeY.js";import{A as E}from"./LoadingAnimations-PRqLBVpN.js";import{A as T}from"./Alert-BTLZx-9d.js";const Q=()=>{const{user:i,logout:c}=r.useContext(y),o=S(),[d,f]=r.useState([]),[v,b]=r.useState(!0),[m,j]=r.useState(null),[w,u]=r.useState(!1),[s,g]=r.useState(null);r.useEffect(()=>{if(!i||i.role!=="admin"){o("/administracion");return}(async()=>{try{const n=localStorage.getItem("token"),x=await fetch(M.quotes,{headers:{Authorization:`Bearer ${n}`}});if(!x.ok)if(x.status===403)j("No tienes permisos para ver las cotizaciones."),await c(),o("/administracion");else throw new Error("Error al cargar las cotizaciones.");const A=await x.json();f(A)}catch(n){j(n.message)}finally{b(!1)}})()},[i,o,c]);const C=a=>{g(a),u(!0)},N=()=>{u(!1),g(null)};return v?e.jsx("div",{className:"loading-overlay",children:e.jsxs("div",{className:"loading-content",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Cargando cotizaciones..."})]})}):m?e.jsx("div",{className:"error-state",children:e.jsxs("div",{className:"error-message",children:[e.jsx("h4",{children:"Error al cargar las cotizaciones"}),e.jsx("p",{children:m}),e.jsx(h,{variant:"outline-danger",onClick:()=>window.location.reload(),children:"Reintentar"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"admin-dashboard-section",children:[e.jsxs(D,{fluid:!0,className:"px-2 px-md-3",children:[e.jsx("h2",{className:"text-center mb-4 text-uppercase fw-semibold text-white",children:"Panel de Administración"}),e.jsx("div",{className:"admin-stats-summary",children:e.jsxs("h4",{children:["Total Cotizaciones: ",d.length]})}),e.jsx(z,{xs:1,sm:2,lg:3,xl:4,className:"g-3 g-md-4",children:d.length>0?d.map((a,n)=>e.jsx(p,{className:"slide-up",style:{animationDelay:`${n*.1}s`},children:e.jsx(t,{className:"quote-admin-card h-100 interactive-element",children:e.jsxs(t.Body,{className:"d-flex flex-column",children:[e.jsx(t.Title,{className:"fw-bold text-truncate",title:a.name,children:a.name}),e.jsxs(t.Text,{className:"flex-grow-1",children:[e.jsx("strong",{children:"RUT:"})," ",a.rut,e.jsx("br",{}),e.jsx("strong",{children:"Altura:"})," ",a.fenceHeight,e.jsx("br",{}),e.jsx("strong",{children:"Metros:"})," ",a.linearMeters,"m"]}),e.jsx(h,{variant:"primary",onClick:()=>C(a),className:"mt-auto touch-feedback",size:"sm",children:"Ver Detalles"})]})})},a.id)):e.jsx(p,{xs:12,className:"fade-in",children:e.jsx(T,{variant:"info",className:"text-center",children:"No hay cotizaciones para mostrar."})})})]}),e.jsxs(l,{show:w,onHide:N,centered:!0,size:"lg",className:"quote-detail-modal",children:[e.jsx(l.Header,{closeButton:!0,children:e.jsx(l.Title,{children:"Detalles de Cotización"})}),e.jsx(l.Body,{children:s&&e.jsx("div",{className:"quote-details",children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-sm-6",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Nombre:"}),e.jsx("br",{}),s.name]})}),e.jsx("div",{className:"col-sm-6",children:e.jsxs("p",{children:[e.jsx("strong",{children:"RUT:"}),e.jsx("br",{}),s.rut]})}),e.jsx("div",{className:"col-sm-6",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Teléfono:"}),e.jsx("br",{}),s.phone]})}),e.jsx("div",{className:"col-sm-6",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"}),e.jsx("br",{}),s.email]})}),e.jsx("div",{className:"col-12",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Dirección/Comuna:"}),e.jsx("br",{}),s.address]})}),e.jsx("div",{className:"col-sm-6",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Altura del Cerco:"}),e.jsx("br",{}),s.fenceHeight]})}),e.jsx("div",{className:"col-sm-6",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Metros Lineales:"}),e.jsx("br",{}),s.linearMeters]})}),e.jsx("div",{className:"col-12",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Mensaje Adicional:"}),e.jsx("br",{}),s.message||"N/A"]})}),e.jsx("div",{className:"col-12",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha de Solicitud:"}),e.jsx("br",{}),new Date(s.timestamp).toLocaleString()]})})]})})}),e.jsx(l.Footer,{children:e.jsx(h,{variant:"secondary",onClick:N,children:"Cerrar"})})]})]}),e.jsx(E,{user:i,onLogout:c})]})};export{Q as default};
