import{r,A as v,u as y,j as e,C as z,R as D,a as p,b as n,B as f,M as a}from"./index-pPcwbg4D.js";import{A as E}from"./Alert-Bt7y9ijl.js";const T=()=>{const{user:i,logout:d}=r.useContext(v),o=y(),[h,C]=r.useState([]),[w,N]=r.useState(!0),[x,j]=r.useState(null),[A,m]=r.useState(!1),[s,u]=r.useState(null);r.useEffect(()=>{if(!i||i.role!=="admin"){o("/administracion");return}(async()=>{try{const c=localStorage.getItem("token"),l=await fetch("http://localhost:5000/api/quotes",{headers:{Authorization:`Bearer ${c}`}});if(!l.ok)if(l.status===403)j("No tienes permisos para ver las cotizaciones."),await d(),o("/administracion");else throw new Error("Error al cargar las cotizaciones.");const b=await l.json();C(b)}catch(c){j(c.message)}finally{N(!1)}})()},[i,o,d]);const S=t=>{u(t),m(!0)},g=()=>{m(!1),u(null)};return w?e.jsx("div",{className:"admin-dashboard-section text-center text-white p-5",children:"Cargando cotizaciones..."}):x?e.jsxs("div",{className:"admin-dashboard-section text-center text-danger p-5",children:["Error: ",x]}):e.jsxs("section",{className:"admin-dashboard-section",children:[e.jsxs(z,{children:[e.jsx("h2",{className:"text-center mb-5 text-uppercase fw-semibold text-white",children:"Panel de Administración - Cotizaciones"}),e.jsx(D,{xs:1,md:2,lg:3,className:"g-4",children:h.length>0?h.map(t=>e.jsx(p,{children:e.jsx(n,{className:"quote-admin-card h-100",children:e.jsxs(n.Body,{className:"d-flex flex-column",children:[e.jsx(n.Title,{className:"fw-bold",children:t.name}),e.jsxs(n.Text,{children:[e.jsx("strong",{children:"RUT:"})," ",t.rut,e.jsx("br",{}),e.jsx("strong",{children:"Altura Cerco:"})," ",t.fenceHeight]}),e.jsx(f,{variant:"primary",onClick:()=>S(t),className:"mt-auto",children:"Más Información"})]})})},t.id)):e.jsx(p,{children:e.jsx(E,{variant:"info",children:"No hay cotizaciones para mostrar."})})})]}),e.jsxs(a,{show:A,onHide:g,centered:!0,size:"lg",children:[e.jsx(a.Header,{closeButton:!0,children:e.jsx(a.Title,{children:"Detalles de Cotización"})}),e.jsx(a.Body,{children:s&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Nombre:"})," ",s.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"RUT:"})," ",s.rut]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Teléfono:"})," ",s.phone]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",s.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Dirección/Comuna:"})," ",s.address]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Altura del Cerco:"})," ",s.fenceHeight]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Metros Lineales:"})," ",s.linearMeters]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Mensaje Adicional:"})," ",s.message||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha de Solicitud:"})," ",new Date(s.timestamp).toLocaleString()]})]})}),e.jsx(a.Footer,{children:e.jsx(f,{variant:"secondary",onClick:g,children:"Cerrar"})})]})]})};export{T as default};
