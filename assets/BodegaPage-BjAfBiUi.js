import{r as m,e as x,P as o,A as Y,u as Z,j as e,B as w,C as ee,R as $,a as v,c as M,I as q,g as R,b as _,M as A}from"./index-CjvveDhR.js";import{A as se}from"./LoadingAnimations-_zIpEffa.js";import{F as d}from"./Form-BX9NS_Qh.js";import{T as re}from"./Table-32sEwHPQ.js";import{A as F}from"./Alert-CNoVHXkI.js";var ae=["color","size","title","className"];function D(){return D=Object.assign?Object.assign.bind():function(s){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var r in a)({}).hasOwnProperty.call(a,r)&&(s[r]=a[r])}return s},D.apply(null,arguments)}function te(s,n){if(s==null)return{};var a,r,l=ne(s,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);for(r=0;r<i.length;r++)a=i[r],n.indexOf(a)===-1&&{}.propertyIsEnumerable.call(s,a)&&(l[a]=s[a])}return l}function ne(s,n){if(s==null)return{};var a={};for(var r in s)if({}.hasOwnProperty.call(s,r)){if(n.indexOf(r)!==-1)continue;a[r]=s[r]}return a}var G=m.forwardRef(function(s,n){var a=s.color,r=a===void 0?"currentColor":a,l=s.size,i=l===void 0?"1em":l,u=s.title,c=u===void 0?null:u,h=s.className,g=h===void 0?"":h,p=te(s,ae);return x.createElement("svg",D({ref:n,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:i,height:i,fill:r,className:["bi","bi-pencil-square",g].filter(Boolean).join(" ")},p),c?x.createElement("title",null,c):null,x.createElement("path",{d:"M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"}),x.createElement("path",{fillRule:"evenodd",d:"M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"}))});G.propTypes={color:o.string,size:o.oneOfType([o.string,o.number]),title:o.string,className:o.string};var le=["color","size","title","className"];function H(){return H=Object.assign?Object.assign.bind():function(s){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var r in a)({}).hasOwnProperty.call(a,r)&&(s[r]=a[r])}return s},H.apply(null,arguments)}function ie(s,n){if(s==null)return{};var a,r,l=oe(s,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);for(r=0;r<i.length;r++)a=i[r],n.indexOf(a)===-1&&{}.propertyIsEnumerable.call(s,a)&&(l[a]=s[a])}return l}function oe(s,n){if(s==null)return{};var a={};for(var r in s)if({}.hasOwnProperty.call(s,r)){if(n.indexOf(r)!==-1)continue;a[r]=s[r]}return a}var Q=m.forwardRef(function(s,n){var a=s.color,r=a===void 0?"currentColor":a,l=s.size,i=l===void 0?"1em":l,u=s.title,c=u===void 0?null:u,h=s.className,g=h===void 0?"":h,p=ie(s,le);return x.createElement("svg",H({ref:n,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:i,height:i,fill:r,className:["bi","bi-plus-circle",g].filter(Boolean).join(" ")},p),c?x.createElement("title",null,c):null,x.createElement("path",{d:"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"}),x.createElement("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"}))});Q.propTypes={color:o.string,size:o.oneOfType([o.string,o.number]),title:o.string,className:o.string};var ce=["color","size","title","className"];function V(){return V=Object.assign?Object.assign.bind():function(s){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var r in a)({}).hasOwnProperty.call(a,r)&&(s[r]=a[r])}return s},V.apply(null,arguments)}function de(s,n){if(s==null)return{};var a,r,l=me(s,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);for(r=0;r<i.length;r++)a=i[r],n.indexOf(a)===-1&&{}.propertyIsEnumerable.call(s,a)&&(l[a]=s[a])}return l}function me(s,n){if(s==null)return{};var a={};for(var r in s)if({}.hasOwnProperty.call(s,r)){if(n.indexOf(r)!==-1)continue;a[r]=s[r]}return a}var W=m.forwardRef(function(s,n){var a=s.color,r=a===void 0?"currentColor":a,l=s.size,i=l===void 0?"1em":l,u=s.title,c=u===void 0?null:u,h=s.className,g=h===void 0?"":h,p=de(s,ce);return x.createElement("svg",V({ref:n,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:i,height:i,fill:r,className:["bi","bi-trash",g].filter(Boolean).join(" ")},p),c?x.createElement("title",null,c):null,x.createElement("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"}),x.createElement("path",{d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"}))});W.propTypes={color:o.string,size:o.oneOfType([o.string,o.number]),title:o.string,className:o.string};const fe=()=>{const{user:s,logout:n}=m.useContext(Y),a=Z(),[r,l]=m.useState([]),[i,u]=m.useState(!0),[c,h]=m.useState(null),[g,p]=m.useState(!1),[f,y]=m.useState(null),[E,B]=m.useState(""),b=t=>t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();m.useEffect(()=>{if(!s||s.role!=="admin"){a("/administracion");return}(async()=>{try{u(!0);const N=localStorage.getItem("token"),C=await fetch(_.products,{headers:{Authorization:`Bearer ${N}`}});if(!C.ok)throw new Error("Error al cargar los productos.");const z=await C.json();l(z)}catch(N){h(N.message)}finally{u(!1)}})()},[s,a]);const j=()=>{p(!1),y(null)},P=(t=null)=>{y(t),p(!0)},S=async(t,N)=>{const C=localStorage.getItem("token"),z=f?"PUT":"POST",X=f?`${_.products}/${f._id}`:_.products;if(!(f&&!window.confirm("¿Estás seguro de que quieres guardar los cambios en este producto?")))try{let k;const U={Authorization:`Bearer ${C}`};if(N){const O=new FormData;for(const K in t)O.append(K,t[K]);O.append("image",N),k=O}else k=JSON.stringify(t),U["Content-Type"]="application/json";const J=await fetch(X,{method:z,headers:U,body:k});if(!J.ok)throw new Error("Error al guardar el producto.");const I=await J.json();l(f?r.map(O=>O._id===I._id?I:O):[...r,I]),j()}catch(k){h(k.message)}},L=async t=>{if(window.confirm("¿Estás seguro de que quieres eliminar este producto?")){const N=localStorage.getItem("token");try{if(!(await fetch(`${_.products}/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${N}`}})).ok)throw new Error("Error al eliminar el producto.");l(r.filter(z=>z._id!==t))}catch(C){h(C.message)}}},T=r.filter(t=>b(t.name).includes(b(E)));return i?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner-border text-light mb-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),e.jsx("p",{children:"Cargando productos..."})]}):c?e.jsx("div",{className:"error-state",children:e.jsxs("div",{className:"alert alert-danger",role:"alert",children:[e.jsx("h4",{className:"alert-heading",children:"Error"}),e.jsx("p",{children:c}),e.jsx("hr",{}),e.jsx("p",{className:"mb-0",children:e.jsx(w,{variant:"outline-danger",onClick:()=>window.location.reload(),children:"Reintentar"})})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"bodega-page-section",children:[e.jsxs(ee,{fluid:!0,className:"px-2 px-md-3",children:[e.jsx("div",{className:"bodega-header",children:e.jsxs($,{className:"mb-3 align-items-center",children:[e.jsx(v,{children:e.jsx("h2",{className:"text-white mb-0",children:"Gestión de Bodega"})}),e.jsx(v,{xs:"auto",children:e.jsxs(w,{variant:"success",onClick:()=>P(),children:[e.jsx(Q,{className:"me-2"}),e.jsx("span",{className:"d-none d-sm-inline",children:"Agregar "}),"Producto"]})})]})}),e.jsxs(M,{className:"shadow-sm",children:[e.jsx(M.Header,{className:"search-filters-section",children:e.jsx(d.Control,{type:"text",placeholder:"Buscar producto por nombre...",value:E,onChange:t=>B(t.target.value)})}),e.jsxs(M.Body,{className:"p-0",children:[e.jsx("div",{className:"product-table-container",children:e.jsxs(re,{responsive:!0,hover:!0,className:"product-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"80px"},children:"Imagen"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{style:{width:"120px"},children:"Stock"}),e.jsx("th",{style:{width:"120px"},children:"Precio"}),e.jsx("th",{style:{width:"120px"},children:"Acciones"})]})}),e.jsx("tbody",{children:T.length>0?T.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.image?e.jsx(q,{src:R(t.image),className:"product-image-table",alt:t.name}):e.jsx("div",{className:"product-image-table bg-light d-flex align-items-center justify-content-center",children:e.jsx("span",{style:{fontSize:"0.7rem",color:"#666"},children:"Sin imagen"})})}),e.jsx("td",{className:"product-name",children:t.name}),e.jsx("td",{children:e.jsxs("span",{className:`badge ${t.stock>50?"bg-success":t.stock>10?"bg-warning":"bg-danger"}`,children:[t.stock," un."]})}),e.jsxs("td",{className:"product-price",children:["$",t.price.toLocaleString("es-CL")]}),e.jsxs("td",{className:"actions-cell",children:[e.jsx(w,{variant:"outline-primary",size:"sm",className:"me-1",onClick:()=>P(t),title:"Editar",children:e.jsx(G,{})}),e.jsx(w,{variant:"outline-danger",size:"sm",onClick:()=>L(t._id),title:"Eliminar",children:e.jsx(W,{})})]})]},t._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center py-4",children:e.jsx(F,{variant:"info",className:"mb-0",children:E?"No se encontraron productos que coincidan con la búsqueda.":"No hay productos registrados."})})})})]})}),e.jsx("div",{className:"mobile-products-view p-3",children:T.length>0?T.map(t=>e.jsx("div",{className:"product-mobile-card",children:e.jsxs($,{className:"align-items-center",children:[e.jsx(v,{xs:"auto",children:t.image?e.jsx(q,{src:R(t.image),className:"product-image-mobile",alt:t.name}):e.jsx("div",{className:"product-image-mobile bg-light d-flex align-items-center justify-content-center",children:e.jsx("span",{style:{fontSize:"0.7rem",color:"#666"},children:"Sin imagen"})})}),e.jsxs(v,{children:[e.jsxs("div",{className:"product-info",children:[e.jsx("h5",{className:"mb-1",children:t.name}),e.jsxs("p",{children:[e.jsx("strong",{children:"Stock:"}),e.jsxs("span",{className:`badge ms-2 ${t.stock>50?"bg-success":t.stock>10?"bg-warning":"bg-danger"}`,children:[t.stock," unidades"]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Precio:"})," $",t.price.toLocaleString("es-CL")]})]}),e.jsxs("div",{className:"product-actions",children:[e.jsxs(w,{variant:"outline-primary",size:"sm",onClick:()=>P(t),children:[e.jsx(G,{className:"me-1"}),"Editar"]}),e.jsxs(w,{variant:"outline-danger",size:"sm",onClick:()=>L(t._id),children:[e.jsx(W,{className:"me-1"}),"Eliminar"]})]})]})]})},t._id)):e.jsx(F,{variant:"info",className:"text-center",children:E?"No se encontraron productos que coincidan con la búsqueda.":"No hay productos registrados."})})]})]})]}),e.jsx(ue,{show:g,handleClose:j,handleSave:S,product:f})]}),e.jsx(se,{user:s,onLogout:n})]})},ue=({show:s,handleClose:n,handleSave:a,product:r})=>{const[l,i]=m.useState({name:"",description:"",stock:0,price:0,image:null}),[u,c]=m.useState(null),[h,g]=m.useState(null),[p,f]=m.useState(null);m.useEffect(()=>{r?(i(r),c(r.image?R(r.image):null),g(null)):(i({name:"",description:"",stock:0,price:0,image:null}),c(null),g(null)),f(null)},[r]);const y=b=>{const{name:j,value:P}=b.target;let S=P;(j==="stock"||j==="price")&&(S=parseInt(P,10),isNaN(S)&&(S=0)),i(L=>({...L,[j]:S}))},E=b=>{const j=b.target.files[0];if(j){if(!["image/png","image/jpg","image/jpeg","image/webp"].includes(j.type)){f("Tipo de archivo no soportado. Solo se permiten PNG, JPG, JPEG y WebP."),c(null),g(null);return}f(null),g(j),c(URL.createObjectURL(j))}else c(null),g(null)},B=b=>{b.preventDefault(),!p&&a(l,h)};return e.jsxs(A,{show:s,onHide:n,centered:!0,className:"product-form-modal",children:[e.jsx(A.Header,{closeButton:!0,children:e.jsx(A.Title,{children:r?"Editar Producto":"Agregar Producto"})}),e.jsx(A.Body,{children:e.jsxs(d,{onSubmit:B,children:[e.jsxs($,{children:[e.jsx(v,{md:6,children:e.jsxs(d.Group,{className:"mb-3",children:[e.jsx(d.Label,{children:"Nombre del Producto"}),e.jsx(d.Control,{type:"text",name:"name",value:l.name,onChange:y,required:!0,placeholder:"Ingrese el nombre del producto"})]})}),e.jsx(v,{md:6,children:e.jsxs(d.Group,{className:"mb-3",children:[e.jsx(d.Label,{children:"Precio (CLP)"}),e.jsx(d.Control,{type:"number",name:"price",value:l.price,onChange:y,required:!0,min:"0",placeholder:"0"})]})})]}),e.jsxs($,{children:[e.jsx(v,{md:6,children:e.jsxs(d.Group,{className:"mb-3",children:[e.jsx(d.Label,{children:"Stock"}),e.jsx(d.Control,{type:"number",name:"stock",value:l.stock,onChange:y,required:!0,min:"0",placeholder:"0"})]})}),e.jsx(v,{md:6,children:e.jsxs(d.Group,{className:"mb-3",children:[e.jsx(d.Label,{children:"Imagen del Producto"}),e.jsx(d.Control,{type:"file",name:"imageFile",onChange:E,accept:".png,.jpg,.jpeg,.webp",size:"sm"}),p&&e.jsx(F,{variant:"danger",className:"mt-2 py-2",children:p})]})})]}),e.jsxs(d.Group,{className:"mb-3",children:[e.jsx(d.Label,{children:"Descripción"}),e.jsx(d.Control,{as:"textarea",rows:3,name:"description",value:l.description,onChange:y,placeholder:"Descripción opcional del producto"})]}),u&&e.jsxs("div",{className:"image-preview",children:[e.jsx("p",{className:"mb-2",children:e.jsx("strong",{children:"Vista previa:"})}),e.jsx(q,{src:u,alt:"Previsualización",fluid:!0,rounded:!0,style:{maxHeight:"120px",maxWidth:"100%"}})]}),e.jsxs($,{className:"mt-4",children:[e.jsx(v,{children:e.jsx(w,{variant:"secondary",onClick:n,className:"w-100 mb-2 mb-md-0",children:"Cancelar"})}),e.jsx(v,{children:e.jsxs(w,{variant:"primary",type:"submit",className:"w-100",disabled:!!p,children:[r?"Actualizar":"Crear"," Producto"]})})]})]})})]})};export{fe as default};
