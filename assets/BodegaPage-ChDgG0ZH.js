import{r as h,e as Q,f as X,j as e,d as x,P as d,A as Y,u as Z,C as ee,R as F,a as B,B as T,b as _,I as H,M as k}from"./index-B6qhDs4e.js";import{F as m}from"./Form-B8QSQFzQ.js";import{A as V}from"./Alert-DoIT_x-r.js";const D=h.forwardRef(({bsPrefix:t,className:a,striped:s,bordered:r,borderless:n,hover:o,size:u,variant:i,responsive:p,...g},c)=>{const f=Q(t,"table"),v=X(a,f,i&&`${f}-${i}`,u&&`${f}-${u}`,s&&`${f}-${typeof s=="string"?`striped-${s}`:"striped"}`,r&&`${f}-bordered`,n&&`${f}-borderless`,o&&`${f}-hover`),P=e.jsx("table",{...g,className:v,ref:c});if(p){let b=`${f}-responsive`;return typeof p=="string"&&(b=`${b}-${p}`),e.jsx("div",{className:b,children:P})}return P});D.displayName="Table";var te=["color","size","title","className"];function A(){return A=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var r in s)({}).hasOwnProperty.call(s,r)&&(t[r]=s[r])}return t},A.apply(null,arguments)}function re(t,a){if(t==null)return{};var s,r,n=se(t,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)s=o[r],a.indexOf(s)===-1&&{}.propertyIsEnumerable.call(t,s)&&(n[s]=t[s])}return n}function se(t,a){if(t==null)return{};var s={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(a.indexOf(r)!==-1)continue;s[r]=t[r]}return s}var W=h.forwardRef(function(t,a){var s=t.color,r=s===void 0?"currentColor":s,n=t.size,o=n===void 0?"1em":n,u=t.title,i=u===void 0?null:u,p=t.className,g=p===void 0?"":p,c=re(t,te);return x.createElement("svg",A({ref:a,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:o,height:o,fill:r,className:["bi","bi-pencil-square",g].filter(Boolean).join(" ")},c),i?x.createElement("title",null,i):null,x.createElement("path",{d:"M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"}),x.createElement("path",{fillRule:"evenodd",d:"M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"}))});W.propTypes={color:d.string,size:d.oneOfType([d.string,d.number]),title:d.string,className:d.string};var ae=["color","size","title","className"];function M(){return M=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var r in s)({}).hasOwnProperty.call(s,r)&&(t[r]=s[r])}return t},M.apply(null,arguments)}function ne(t,a){if(t==null)return{};var s,r,n=oe(t,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)s=o[r],a.indexOf(s)===-1&&{}.propertyIsEnumerable.call(t,s)&&(n[s]=t[s])}return n}function oe(t,a){if(t==null)return{};var s={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(a.indexOf(r)!==-1)continue;s[r]=t[r]}return s}var J=h.forwardRef(function(t,a){var s=t.color,r=s===void 0?"currentColor":s,n=t.size,o=n===void 0?"1em":n,u=t.title,i=u===void 0?null:u,p=t.className,g=p===void 0?"":p,c=ne(t,ae);return x.createElement("svg",M({ref:a,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:o,height:o,fill:r,className:["bi","bi-plus-circle",g].filter(Boolean).join(" ")},c),i?x.createElement("title",null,i):null,x.createElement("path",{d:"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"}),x.createElement("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"}))});J.propTypes={color:d.string,size:d.oneOfType([d.string,d.number]),title:d.string,className:d.string};var le=["color","size","title","className"];function I(){return I=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var r in s)({}).hasOwnProperty.call(s,r)&&(t[r]=s[r])}return t},I.apply(null,arguments)}function ie(t,a){if(t==null)return{};var s,r,n=ce(t,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)s=o[r],a.indexOf(s)===-1&&{}.propertyIsEnumerable.call(t,s)&&(n[s]=t[s])}return n}function ce(t,a){if(t==null)return{};var s={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(a.indexOf(r)!==-1)continue;s[r]=t[r]}return s}var U=h.forwardRef(function(t,a){var s=t.color,r=s===void 0?"currentColor":s,n=t.size,o=n===void 0?"1em":n,u=t.title,i=u===void 0?null:u,p=t.className,g=p===void 0?"":p,c=ie(t,le);return x.createElement("svg",I({ref:a,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:o,height:o,fill:r,className:["bi","bi-trash",g].filter(Boolean).join(" ")},c),i?x.createElement("title",null,i):null,x.createElement("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"}),x.createElement("path",{d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"}))});U.propTypes={color:d.string,size:d.oneOfType([d.string,d.number]),title:d.string,className:d.string};const pe=()=>{const{user:t}=h.useContext(Y),a=Z(),[s,r]=h.useState([]),[n,o]=h.useState(!0),[u,i]=h.useState(null),[p,g]=h.useState(!1),[c,f]=h.useState(null),[v,P]=h.useState(""),b=l=>l.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();h.useEffect(()=>{if(!t||t.role!=="admin"){a("/administracion");return}(async()=>{try{o(!0);const y=localStorage.getItem("token"),N=await fetch("http://localhost:5000/api/products",{headers:{Authorization:`Bearer ${y}`}});if(!N.ok)throw new Error("Error al cargar los productos.");const O=await N.json();r(O)}catch(y){i(y.message)}finally{o(!1)}})()},[t,a]);const w=()=>{g(!1),f(null)},j=(l=null)=>{f(l),g(!0)},C=async(l,y)=>{const N=localStorage.getItem("token"),O=c?"PUT":"POST",K=c?`http://localhost:5000/api/products/${c._id}`:"http://localhost:5000/api/products";if(!(c&&!window.confirm("¿Estás seguro de que quieres guardar los cambios en este producto?")))try{let S;const R={Authorization:`Bearer ${N}`};if(y){const E=new FormData;for(const q in l)E.append(q,l[q]);E.append("image",y),S=E}else S=JSON.stringify(l),R["Content-Type"]="application/json";const G=await fetch(K,{method:O,headers:R,body:S});if(!G.ok)throw new Error("Error al guardar el producto.");const L=await G.json();r(c?s.map(E=>E._id===L._id?L:E):[...s,L]),w()}catch(S){i(S.message)}},$=async l=>{if(window.confirm("¿Estás seguro de que quieres eliminar este producto?")){const y=localStorage.getItem("token");try{if(!(await fetch(`http://localhost:5000/api/products/${l}`,{method:"DELETE",headers:{Authorization:`Bearer ${y}`}})).ok)throw new Error("Error al eliminar el producto.");r(s.filter(O=>O._id!==l))}catch(N){i(N.message)}}},z=s.filter(l=>b(l.name).includes(b(v)));return n?e.jsx("div",{className:"text-center text-white p-5",children:"Cargando productos..."}):u?e.jsxs("div",{className:"text-center text-danger p-5",children:["Error: ",u]}):e.jsxs("section",{className:"bodega-page-section",children:[e.jsxs(ee,{fluid:!0,children:[e.jsxs(F,{className:"mb-4 align-items-center",children:[e.jsx(B,{children:e.jsx("h2",{className:"text-white",children:"Gestión de Bodega"})}),e.jsx(B,{xs:"auto",children:e.jsxs(T,{variant:"success",onClick:()=>j(),children:[e.jsx(J,{className:"me-2"}),"Agregar Producto"]})})]}),e.jsxs(_,{className:"shadow-sm",children:[e.jsx(_.Header,{children:e.jsx(m.Control,{type:"text",placeholder:"Buscar producto por nombre...",value:v,onChange:l=>P(l.target.value)})}),e.jsx(_.Body,{children:e.jsxs(D,{responsive:!0,hover:!0,className:"product-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Imagen"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Stock"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:z.length>0?z.map(l=>e.jsxs("tr",{children:[e.jsx("td",{children:l.image&&e.jsx(H,{src:`http://localhost:5000${l.image}`,rounded:!0,width:"60"})}),e.jsx("td",{className:"fw-bold",children:l.name}),e.jsx("td",{children:e.jsxs("span",{className:`badge ${l.stock>50?"bg-success":l.stock>10?"bg-warning":"bg-danger"}`,children:[l.stock," unidades"]})}),e.jsxs("td",{children:["$",l.price.toLocaleString("es-CL")]}),e.jsxs("td",{children:[e.jsx(T,{variant:"outline-primary",size:"sm",className:"me-2",onClick:()=>j(l),children:e.jsx(W,{})}),e.jsx(T,{variant:"outline-danger",size:"sm",onClick:()=>$(l._id),children:e.jsx(U,{})})]})]},l._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center",children:e.jsx(V,{variant:"info",children:"No se encontraron productos."})})})})]})})]})]}),e.jsx(de,{show:p,handleClose:w,handleSave:C,product:c})]})},de=({show:t,handleClose:a,handleSave:s,product:r})=>{const[n,o]=h.useState({name:"",description:"",stock:0,price:0,image:null}),[u,i]=h.useState(null),[p,g]=h.useState(null),[c,f]=h.useState(null);h.useEffect(()=>{r?(o(r),i(r.image?`http://localhost:5000${r.image}`:null),g(null)):(o({name:"",description:"",stock:0,price:0,image:null}),i(null),g(null)),f(null)},[r]);const v=w=>{const{name:j,value:C}=w.target;let $=C;(j==="stock"||j==="price")&&($=parseInt(C,10),isNaN($)&&($=0)),o(z=>({...z,[j]:$}))},P=w=>{const j=w.target.files[0];if(j){if(!["image/png","image/jpg","image/jpeg","image/webp"].includes(j.type)){f("Tipo de archivo no soportado. Solo se permiten PNG, JPG, JPEG y WebP."),i(null),g(null);return}f(null),g(j),i(URL.createObjectURL(j))}else i(null),g(null)},b=w=>{w.preventDefault(),!c&&s(n,p)};return e.jsxs(k,{show:t,onHide:a,centered:!0,children:[e.jsx(k.Header,{closeButton:!0,children:e.jsx(k.Title,{children:r?"Editar Producto":"Agregar Producto"})}),e.jsx(k.Body,{children:e.jsxs(m,{onSubmit:b,children:[e.jsxs(m.Group,{className:"mb-3",children:[e.jsx(m.Label,{children:"Nombre del Producto"}),e.jsx(m.Control,{type:"text",name:"name",value:n.name,onChange:v,required:!0})]}),e.jsxs(m.Group,{className:"mb-3",children:[e.jsx(m.Label,{children:"Descripción"}),e.jsx(m.Control,{as:"textarea",rows:3,name:"description",value:n.description,onChange:v})]}),e.jsxs(m.Group,{className:"mb-3",children:[e.jsx(m.Label,{children:"Imagen del Producto"}),e.jsx(m.Control,{type:"file",name:"imageFile",onChange:P,accept:".png,.jpg,.jpeg,.webp"}),c&&e.jsx(V,{variant:"danger",className:"mt-2",children:c}),u&&e.jsx("div",{className:"mt-3 text-center",children:e.jsx(H,{src:u,alt:"Previsualización",fluid:!0,rounded:!0,style:{maxHeight:"150px"}})})]}),e.jsxs(F,{children:[e.jsx(B,{children:e.jsxs(m.Group,{className:"mb-3",children:[e.jsx(m.Label,{children:"Stock"}),e.jsx(m.Control,{type:"number",name:"stock",value:n.stock,onChange:v,required:!0,min:"0"})]})}),e.jsx(B,{children:e.jsxs(m.Group,{className:"mb-3",children:[e.jsx(m.Label,{children:"Precio"}),e.jsx(m.Control,{type:"number",name:"price",value:n.price,onChange:v,required:!0,min:"0"})]})})]}),e.jsx(T,{variant:"primary",type:"submit",className:"w-100",children:"Guardar Cambios"})]})})]})};export{pe as default};
