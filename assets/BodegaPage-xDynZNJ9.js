import{r as g,f as Z,g as ee,j as e,e as j,P as m,A as se,u as re,B as P,C as ae,R as L,a as v,c as M,I as q,h as R,b as A,M as B}from"./index-Oz_OtaLj.js";import{A as te}from"./LoadingAnimations-CHjsV0ER.js";import{F as h}from"./Form-BZsI-z2A.js";import{A as F}from"./Alert-n9N3cVv9.js";const Q=g.forwardRef(({bsPrefix:s,className:t,striped:a,bordered:r,borderless:l,hover:i,size:u,variant:o,responsive:d,...p},x)=>{const c=Z(s,"table"),b=ee(t,c,o&&`${c}-${o}`,u&&`${c}-${u}`,a&&`${c}-${typeof a=="string"?`striped-${a}`:"striped"}`,r&&`${c}-bordered`,l&&`${c}-borderless`,i&&`${c}-hover`),N=e.jsx("table",{...p,className:b,ref:x});if(d){let $=`${c}-responsive`;return typeof d=="string"&&($=`${$}-${d}`),e.jsx("div",{className:$,children:N})}return N});Q.displayName="Table";var ne=["color","size","title","className"];function D(){return D=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(s[r]=a[r])}return s},D.apply(null,arguments)}function le(s,t){if(s==null)return{};var a,r,l=ie(s,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)===-1&&{}.propertyIsEnumerable.call(s,a)&&(l[a]=s[a])}return l}function ie(s,t){if(s==null)return{};var a={};for(var r in s)if({}.hasOwnProperty.call(s,r)){if(t.indexOf(r)!==-1)continue;a[r]=s[r]}return a}var G=g.forwardRef(function(s,t){var a=s.color,r=a===void 0?"currentColor":a,l=s.size,i=l===void 0?"1em":l,u=s.title,o=u===void 0?null:u,d=s.className,p=d===void 0?"":d,x=le(s,ne);return j.createElement("svg",D({ref:t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:i,height:i,fill:r,className:["bi","bi-pencil-square",p].filter(Boolean).join(" ")},x),o?j.createElement("title",null,o):null,j.createElement("path",{d:"M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"}),j.createElement("path",{fillRule:"evenodd",d:"M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"}))});G.propTypes={color:m.string,size:m.oneOfType([m.string,m.number]),title:m.string,className:m.string};var oe=["color","size","title","className"];function H(){return H=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(s[r]=a[r])}return s},H.apply(null,arguments)}function ce(s,t){if(s==null)return{};var a,r,l=de(s,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)===-1&&{}.propertyIsEnumerable.call(s,a)&&(l[a]=s[a])}return l}function de(s,t){if(s==null)return{};var a={};for(var r in s)if({}.hasOwnProperty.call(s,r)){if(t.indexOf(r)!==-1)continue;a[r]=s[r]}return a}var X=g.forwardRef(function(s,t){var a=s.color,r=a===void 0?"currentColor":a,l=s.size,i=l===void 0?"1em":l,u=s.title,o=u===void 0?null:u,d=s.className,p=d===void 0?"":d,x=ce(s,oe);return j.createElement("svg",H({ref:t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:i,height:i,fill:r,className:["bi","bi-plus-circle",p].filter(Boolean).join(" ")},x),o?j.createElement("title",null,o):null,j.createElement("path",{d:"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"}),j.createElement("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"}))});X.propTypes={color:m.string,size:m.oneOfType([m.string,m.number]),title:m.string,className:m.string};var me=["color","size","title","className"];function V(){return V=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(s[r]=a[r])}return s},V.apply(null,arguments)}function ue(s,t){if(s==null)return{};var a,r,l=he(s,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)===-1&&{}.propertyIsEnumerable.call(s,a)&&(l[a]=s[a])}return l}function he(s,t){if(s==null)return{};var a={};for(var r in s)if({}.hasOwnProperty.call(s,r)){if(t.indexOf(r)!==-1)continue;a[r]=s[r]}return a}var W=g.forwardRef(function(s,t){var a=s.color,r=a===void 0?"currentColor":a,l=s.size,i=l===void 0?"1em":l,u=s.title,o=u===void 0?null:u,d=s.className,p=d===void 0?"":d,x=ue(s,me);return j.createElement("svg",V({ref:t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:i,height:i,fill:r,className:["bi","bi-trash",p].filter(Boolean).join(" ")},x),o?j.createElement("title",null,o):null,j.createElement("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"}),j.createElement("path",{d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"}))});W.propTypes={color:m.string,size:m.oneOfType([m.string,m.number]),title:m.string,className:m.string};const ve=()=>{const{user:s,logout:t}=g.useContext(se),a=re(),[r,l]=g.useState([]),[i,u]=g.useState(!0),[o,d]=g.useState(null),[p,x]=g.useState(!1),[c,b]=g.useState(null),[N,$]=g.useState(""),w=n=>n.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();g.useEffect(()=>{if(!s||s.role!=="admin"){a("/administracion");return}(async()=>{try{u(!0);const y=localStorage.getItem("token"),E=await fetch(A.products,{headers:{Authorization:`Bearer ${y}`}});if(!E.ok)throw new Error("Error al cargar los productos.");const z=await E.json();l(z)}catch(y){d(y.message)}finally{u(!1)}})()},[s,a]);const f=()=>{x(!1),b(null)},C=(n=null)=>{b(n),x(!0)},S=async(n,y)=>{const E=localStorage.getItem("token"),z=c?"PUT":"POST",Y=c?`${A.products}/${c._id}`:A.products;if(!(c&&!window.confirm("¿Estás seguro de que quieres guardar los cambios en este producto?")))try{let k;const U={Authorization:`Bearer ${E}`};if(y){const O=new FormData;for(const K in n)O.append(K,n[K]);O.append("image",y),k=O}else k=JSON.stringify(n),U["Content-Type"]="application/json";const J=await fetch(Y,{method:z,headers:U,body:k});if(!J.ok)throw new Error("Error al guardar el producto.");const I=await J.json();l(c?r.map(O=>O._id===I._id?I:O):[...r,I]),f()}catch(k){d(k.message)}},T=async n=>{if(window.confirm("¿Estás seguro de que quieres eliminar este producto?")){const y=localStorage.getItem("token");try{if(!(await fetch(`${A.products}/${n}`,{method:"DELETE",headers:{Authorization:`Bearer ${y}`}})).ok)throw new Error("Error al eliminar el producto.");l(r.filter(z=>z._id!==n))}catch(E){d(E.message)}}},_=r.filter(n=>w(n.name).includes(w(N)));return i?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner-border text-light mb-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),e.jsx("p",{children:"Cargando productos..."})]}):o?e.jsx("div",{className:"error-state",children:e.jsxs("div",{className:"alert alert-danger",role:"alert",children:[e.jsx("h4",{className:"alert-heading",children:"Error"}),e.jsx("p",{children:o}),e.jsx("hr",{}),e.jsx("p",{className:"mb-0",children:e.jsx(P,{variant:"outline-danger",onClick:()=>window.location.reload(),children:"Reintentar"})})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"bodega-page-section",children:[e.jsxs(ae,{fluid:!0,className:"px-2 px-md-3",children:[e.jsx("div",{className:"bodega-header",children:e.jsxs(L,{className:"mb-3 align-items-center",children:[e.jsx(v,{children:e.jsx("h2",{className:"text-white mb-0",children:"Gestión de Bodega"})}),e.jsx(v,{xs:"auto",children:e.jsxs(P,{variant:"success",onClick:()=>C(),children:[e.jsx(X,{className:"me-2"}),e.jsx("span",{className:"d-none d-sm-inline",children:"Agregar "}),"Producto"]})})]})}),e.jsxs(M,{className:"shadow-sm",children:[e.jsx(M.Header,{className:"search-filters-section",children:e.jsx(h.Control,{type:"text",placeholder:"Buscar producto por nombre...",value:N,onChange:n=>$(n.target.value)})}),e.jsxs(M.Body,{className:"p-0",children:[e.jsx("div",{className:"product-table-container",children:e.jsxs(Q,{responsive:!0,hover:!0,className:"product-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"80px"},children:"Imagen"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{style:{width:"120px"},children:"Stock"}),e.jsx("th",{style:{width:"120px"},children:"Precio"}),e.jsx("th",{style:{width:"120px"},children:"Acciones"})]})}),e.jsx("tbody",{children:_.length>0?_.map(n=>e.jsxs("tr",{children:[e.jsx("td",{children:n.image?e.jsx(q,{src:R(n.image),className:"product-image-table",alt:n.name}):e.jsx("div",{className:"product-image-table bg-light d-flex align-items-center justify-content-center",children:e.jsx("span",{style:{fontSize:"0.7rem",color:"#666"},children:"Sin imagen"})})}),e.jsx("td",{className:"product-name",children:n.name}),e.jsx("td",{children:e.jsxs("span",{className:`badge ${n.stock>50?"bg-success":n.stock>10?"bg-warning":"bg-danger"}`,children:[n.stock," un."]})}),e.jsxs("td",{className:"product-price",children:["$",n.price.toLocaleString("es-CL")]}),e.jsxs("td",{className:"actions-cell",children:[e.jsx(P,{variant:"outline-primary",size:"sm",className:"me-1",onClick:()=>C(n),title:"Editar",children:e.jsx(G,{})}),e.jsx(P,{variant:"outline-danger",size:"sm",onClick:()=>T(n._id),title:"Eliminar",children:e.jsx(W,{})})]})]},n._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center py-4",children:e.jsx(F,{variant:"info",className:"mb-0",children:N?"No se encontraron productos que coincidan con la búsqueda.":"No hay productos registrados."})})})})]})}),e.jsx("div",{className:"mobile-products-view p-3",children:_.length>0?_.map(n=>e.jsx("div",{className:"product-mobile-card",children:e.jsxs(L,{className:"align-items-center",children:[e.jsx(v,{xs:"auto",children:n.image?e.jsx(q,{src:R(n.image),className:"product-image-mobile",alt:n.name}):e.jsx("div",{className:"product-image-mobile bg-light d-flex align-items-center justify-content-center",children:e.jsx("span",{style:{fontSize:"0.7rem",color:"#666"},children:"Sin imagen"})})}),e.jsxs(v,{children:[e.jsxs("div",{className:"product-info",children:[e.jsx("h5",{className:"mb-1",children:n.name}),e.jsxs("p",{children:[e.jsx("strong",{children:"Stock:"}),e.jsxs("span",{className:`badge ms-2 ${n.stock>50?"bg-success":n.stock>10?"bg-warning":"bg-danger"}`,children:[n.stock," unidades"]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Precio:"})," $",n.price.toLocaleString("es-CL")]})]}),e.jsxs("div",{className:"product-actions",children:[e.jsxs(P,{variant:"outline-primary",size:"sm",onClick:()=>C(n),children:[e.jsx(G,{className:"me-1"}),"Editar"]}),e.jsxs(P,{variant:"outline-danger",size:"sm",onClick:()=>T(n._id),children:[e.jsx(W,{className:"me-1"}),"Eliminar"]})]})]})]})},n._id)):e.jsx(F,{variant:"info",className:"text-center",children:N?"No se encontraron productos que coincidan con la búsqueda.":"No hay productos registrados."})})]})]})]}),e.jsx(ge,{show:p,handleClose:f,handleSave:S,product:c})]}),e.jsx(te,{user:s,onLogout:t})]})},ge=({show:s,handleClose:t,handleSave:a,product:r})=>{const[l,i]=g.useState({name:"",description:"",stock:0,price:0,image:null}),[u,o]=g.useState(null),[d,p]=g.useState(null),[x,c]=g.useState(null);g.useEffect(()=>{r?(i(r),o(r.image?R(r.image):null),p(null)):(i({name:"",description:"",stock:0,price:0,image:null}),o(null),p(null)),c(null)},[r]);const b=w=>{const{name:f,value:C}=w.target;let S=C;(f==="stock"||f==="price")&&(S=parseInt(C,10),isNaN(S)&&(S=0)),i(T=>({...T,[f]:S}))},N=w=>{const f=w.target.files[0];if(f){if(!["image/png","image/jpg","image/jpeg","image/webp"].includes(f.type)){c("Tipo de archivo no soportado. Solo se permiten PNG, JPG, JPEG y WebP."),o(null),p(null);return}c(null),p(f),o(URL.createObjectURL(f))}else o(null),p(null)},$=w=>{w.preventDefault(),!x&&a(l,d)};return e.jsxs(B,{show:s,onHide:t,centered:!0,className:"product-form-modal",children:[e.jsx(B.Header,{closeButton:!0,children:e.jsx(B.Title,{children:r?"Editar Producto":"Agregar Producto"})}),e.jsx(B.Body,{children:e.jsxs(h,{onSubmit:$,children:[e.jsxs(L,{children:[e.jsx(v,{md:6,children:e.jsxs(h.Group,{className:"mb-3",children:[e.jsx(h.Label,{children:"Nombre del Producto"}),e.jsx(h.Control,{type:"text",name:"name",value:l.name,onChange:b,required:!0,placeholder:"Ingrese el nombre del producto"})]})}),e.jsx(v,{md:6,children:e.jsxs(h.Group,{className:"mb-3",children:[e.jsx(h.Label,{children:"Precio (CLP)"}),e.jsx(h.Control,{type:"number",name:"price",value:l.price,onChange:b,required:!0,min:"0",placeholder:"0"})]})})]}),e.jsxs(L,{children:[e.jsx(v,{md:6,children:e.jsxs(h.Group,{className:"mb-3",children:[e.jsx(h.Label,{children:"Stock"}),e.jsx(h.Control,{type:"number",name:"stock",value:l.stock,onChange:b,required:!0,min:"0",placeholder:"0"})]})}),e.jsx(v,{md:6,children:e.jsxs(h.Group,{className:"mb-3",children:[e.jsx(h.Label,{children:"Imagen del Producto"}),e.jsx(h.Control,{type:"file",name:"imageFile",onChange:N,accept:".png,.jpg,.jpeg,.webp",size:"sm"}),x&&e.jsx(F,{variant:"danger",className:"mt-2 py-2",children:x})]})})]}),e.jsxs(h.Group,{className:"mb-3",children:[e.jsx(h.Label,{children:"Descripción"}),e.jsx(h.Control,{as:"textarea",rows:3,name:"description",value:l.description,onChange:b,placeholder:"Descripción opcional del producto"})]}),u&&e.jsxs("div",{className:"image-preview",children:[e.jsx("p",{className:"mb-2",children:e.jsx("strong",{children:"Vista previa:"})}),e.jsx(q,{src:u,alt:"Previsualización",fluid:!0,rounded:!0,style:{maxHeight:"120px",maxWidth:"100%"}})]}),e.jsxs(L,{className:"mt-4",children:[e.jsx(v,{children:e.jsx(P,{variant:"secondary",onClick:t,className:"w-100 mb-2 mb-md-0",children:"Cancelar"})}),e.jsx(v,{children:e.jsxs(P,{variant:"primary",type:"submit",className:"w-100",disabled:!!x,children:[r?"Actualizar":"Crear"," Producto"]})})]})]})})]})};export{ve as default};
